{
  "variables": {
    "app": "smartpension_rails_app",
    "region": "eu-west-1",
    "machine_type": "t2.micro",
    "ansible_playbook_file": "../ansible/playbook.yml",
    "ansibe_playbook_dir": "../ansible/",
    "ssh_username": "ubuntu"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "{{user `aws_region`}}",
      "source_ami_filter": {
	    "filters": {
	     "virtualization-type": "hvm",
	     "name": "ubuntu/images/hvm-ssd/ubuntu-xenial-16.04-amd64-server-*",
	     "root-device-type": "ebs"
	    },
	    "owners": [
	     "679593333241"
	    ],
	    "most_recent": true
	   },
      "instance_type": "{{ user `machine_type` }}",
      "ssh_username": "{{ user `ssh_username` }}",
      "ami_name": "{{user `app`}} {{timestamp}}",
      "ami_virtualization_type": "hvm",
      "communicator": "ssh",
      "ssh_pty": "true"
    }
  ], 
  "provisioners": [
    {
      "type": "ansible",
      "playbook_file": "{{ user `ansible_playbook_file`}}"
    }
  ]
}
